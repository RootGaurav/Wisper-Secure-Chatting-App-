<Window x:Class="Connectt.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Whisper" Height="600" Width="900"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Background="#EDEAE5">

    <Window.Resources>
        <!-- Brushes and Colors -->
        <SolidColorBrush x:Key="Ink" Color="#026670"/>
        <SolidColorBrush x:Key="GlassFill" Color="#C0FEF9C7"/>
        <SolidColorBrush x:Key="GlassStroke" Color="#60996670"/>
        <SolidColorBrush x:Key="Accent" Color="#43A047"/>
        <SolidColorBrush x:Key="BackgroundBrush" Color="#EDEAE5"/>
        <SolidColorBrush x:Key="SidebarBackground" Color="#9FEDD7"/>
        <SolidColorBrush x:Key="SidebarHover" Color="#33FFFFFF"/>

        <!-- REFACTOR 2: Define Images as Resources for better management -->
        <BitmapImage x:Key="FriendRequestIcon" UriSource="/Friend_Request.png" />
        <BitmapImage x:Key="ChatIcon" UriSource="/Chat_1.png" />

        <!-- Effects -->
        <DropShadowEffect x:Key="GeneralDropShadow" Color="#60996670" BlurRadius="16" ShadowDepth="0" Opacity="0.35"/>
        <DropShadowEffect x:Key="ButtonHoverShadow" Color="#6600A047" BlurRadius="16" ShadowDepth="0"/>

        <!-- REFACTOR 1: Consolidated Style for Sidebar Buttons -->
        <!-- This single style replaces the two separate, inline ControlTemplates.
             It uses the Content property for the ImageSource and the Tag property for the TextBlock. -->
        <Style x:Key="SidebarButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="10" Background="{TemplateBinding Background}" Padding="10,8">
                            <StackPanel>
                                <Image Source="{Binding Content, RelativeSource={RelativeSource TemplatedParent}}" 
                                       Width="54" Height="59" 
                                       RenderOptions.BitmapScalingMode="HighQuality" 
                                       Stretch="Uniform"/>
                                <TextBlock Text="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}" 
                                           Margin="0,5,0,0" 
                                           Foreground="{TemplateBinding Foreground}" 
                                           TextAlignment="Center"
                                           FontSize="12"
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource SidebarHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.85"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- General Styles -->
        <Style x:Key="Sidebar" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource SidebarBackground}"/>
            <Setter Property="CornerRadius" Value="0,12,12,0"/>
            <Setter Property="Effect" Value="{StaticResource GeneralDropShadow}"/>
        </Style>

        <Style x:Key="HeaderCard" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Background" Value="{StaticResource GlassFill}"/>
            <Setter Property="BorderBrush" Value="{StaticResource GlassStroke}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect" Value="{StaticResource GeneralDropShadow}"/>
        </Style>

        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="{StaticResource Ink}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" CornerRadius="8" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#32996670"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.ColumnDefinitions>
            <!-- Sidebar column with a fixed initial width but can shrink to a minimum -->
            <ColumnDefinition Width="90" MinWidth="70"/>
            <!-- Main content column that takes up the remaining space -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar Panel -->
        <Border Grid.Column="0" Style="{StaticResource Sidebar}">
            <StackPanel VerticalAlignment="Center" Margin="0,24">
                <!-- REFACTOR 2: Using the new consolidated style -->
                <Button Style="{StaticResource SidebarButton}" 
                        Content="{StaticResource FriendRequestIcon}" 
                        Tag="Requests"
                        Click="FriendRequestButton_Click"/>

                <Button Style="{StaticResource SidebarButton}" 
                        Content="{StaticResource ChatIcon}" 
                        Tag="Chat"
                        Margin="0,20,0,0"
                        Click="ChatButton_Click"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <!-- Header row that fits its content -->
                <RowDefinition Height="Auto"/>
                <!-- Content row that fills the remaining space -->
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Style="{StaticResource HeaderCard}" Padding="12,0">
                <Grid>
                    <TextBlock Text="Whisper" 
                               HorizontalAlignment="Center" VerticalAlignment="Center" 
                               FontSize="22" FontWeight="SemiBold" 
                               Foreground="{StaticResource Ink}"/>

                    <Button Grid.Column="1" Style="{StaticResource IconButton}" 
                            ToolTip="Reload" 
                            Click="ReloadButton_Click"
                            HorizontalAlignment="Right">
                        <!-- REFACTOR 3: Using a vector Path for the reload icon.
                             It scales perfectly and its Fill is bound to the button's Foreground color. -->
                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                              Data="M12,4 C16.42,4 20,7.58 20,12 C20,16.42 16.42,20 12,20 C7.58,20 4,16.42 4,12 C4,11.56 4.04,11.13 4.1,10.71 L5.54,12.15 C5.51,12.1 5.5,12.05 5.5,12 C5.5,15.59 8.41,18.5 12,18.5 C15.59,18.5 18.5,15.59 18.5,12 C18.5,8.41 15.59,5.5 12,5.5 C11.08,5.5 10.21,5.71 9.44,6.09 L10.88,7.53 C11.23,7.51 11.61,7.5 12,7.5 C14.49,7.5 16.5,9.51 16.5,12 C16.5,12.39 16.47,12.77 16.42,13.12 L17.91,14.61 C17.97,13.75 18,12.88 18,12 C18,8.69 15.31,6 12,6 L12,4 Z M2.47,3.9 L4.59,6 H12 C12.88,6 13.75,6.03 14.61,6.09 L13.12,7.58 C12.77,7.53 12.39,7.5 12,7.5 C9.51,7.5 7.5,9.51 7.5,12 C7.5,12.39 7.53,12.77 7.58,13.12 L6.09,14.61 C5.71,13.84 5.5,12.96 5.5,12 C5.5,8.41 8.41,5.5 12,5.5 V8 L16,4 L12,0 V3 C8.69,3 6,5.69 6,9 L6.09,10.59 L3.9,8.41 L2.47,3.9 Z" 
                              Stretch="Uniform" 
                              Width="18"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Main Content Display -->
            <Border Grid.Row="1" CornerRadius="12" Background="{StaticResource GlassFill}" 
                    BorderBrush="{StaticResource GlassStroke}" BorderThickness="1" 
                    Margin="0,10,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#558BCB75" BlurRadius="16" ShadowDepth="0" Opacity="0.35"/>
                </Border.Effect>
                <ContentControl x:Name="MainContent" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch"/>
            </Border>
        </Grid>
    </Grid>
</Window>
